DROP TABLE SALE CASCADE CONSTRAINTS;
DROP TABLE PRODUCT CASCADE CONSTRAINTS;
DROP TABLE CUSTOMER CASCADE CONSTRAINTS;
DROP TABLE LOCATION CASCADE CONSTRAINTS;
/
CREATE TABLE CUSTOMER (
CUSTID	NUMBER
, CUSTNAME	VARCHAR2(100)
, SALES_YTD	NUMBER
, STATUS	VARCHAR2(7)
, PRIMARY KEY	(CUSTID) 
);
/
CREATE TABLE PRODUCT (
PRODID	NUMBER
, PRODNAME	VARCHAR2(100)
, SELLING_PRICE	NUMBER
, SALES_YTD	NUMBER
, PRIMARY KEY	(PRODID)
);

/

CREATE TABLE SALE (
SALEID	NUMBER
, CUSTID	NUMBER
, PRODID	NUMBER
, QTY	NUMBER
, PRICE	NUMBER
, SALEDATE	DATE
, PRIMARY KEY 	(SALEID)
, FOREIGN KEY 	(CUSTID) REFERENCES CUSTOMER
, FOREIGN KEY 	(PRODID) REFERENCES PRODUCT
);

/

CREATE TABLE LOCATION (
  LOCID	VARCHAR2(5)
, MINQTY	NUMBER
, MAXQTY	NUMBER
, PRIMARY KEY 	(LOCID)
, CONSTRAINT CHECK_LOCID_LENGTH CHECK (LENGTH(LOCID) = 5)
, CONSTRAINT CHECK_MINQTY_RANGE CHECK (MINQTY BETWEEN 0 AND 999)
, CONSTRAINT CHECK_MAXQTY_RANGE CHECK (MAXQTY BETWEEN 0 AND 999)
, CONSTRAINT CHECK_MAXQTY_GREATER_MIXQTY CHECK (MAXQTY >= MINQTY)
);
/

DROP SEQUENCE SALE_SEQ;
CREATE SEQUENCE SALE_SEQ;


BEGIN
  dbms_output.put_line('Student ID: 700513X');
  DELETE_ALL_SALES_VIASQLDEV;
  DELETE_ALL_CUSTOMERS_VIASQLDEV;
  DELETE_ALL_PRODUCTS_VIASQLDEV;
  dbms_output.put_line('==========TEST ADD CUSTOMERS ==========================');
  ADD_CUSTOMER_VIASQLDEV(1,'Colin Smith');
  ADD_CUSTOMER_VIASQLDEV(2,'Jill Davis');
  ADD_CUSTOMER_VIASQLDEV(3,'Dave Brown');
  ADD_CUSTOMER_VIASQLDEV(4,'Kirsty Glass');
  ADD_CUSTOMER_VIASQLDEV(1,'Jenny Nighy');
  ADD_CUSTOMER_VIASQLDEV(-3,'Emma Jones');
  ADD_CUSTOMER_VIASQLDEV(666,'Peter White');
  dbms_output.put_line('==========TEST ADD PRODUCTS==========================');
  ADD_PRODUCT_VIASQLDEV(1001,'ProdA', 10);
  ADD_PRODUCT_VIASQLDEV(1002,'ProdB', 20);
  ADD_PRODUCT_VIASQLDEV(1003,'ProdC', 35);
  ADD_PRODUCT_VIASQLDEV(1001,'ProdD', 10);
  ADD_PRODUCT_VIASQLDEV(3333,'ProdD', 100);
  ADD_PRODUCT_VIASQLDEV(1004,'ProdD', 1234);
  dbms_output.put_line('===========TEST STATUS UPDATES ==========================');
  UPD_CUST_STATUS_VIASQLDEV(3,'SUSPEND');
  UPD_CUST_STATUS_VIASQLDEV(4,'QWERTY');
  dbms_output.put_line('===========TEST CUSTOMER RETREIVAL ==========================');
  GET_CUST_STRING_VIASQLDEV(1);
  GET_CUST_STRING_VIASQLDEV(2);
  GET_CUST_STRING_VIASQLDEV(22);
  dbms_output.put_line('===========TEST PRODUCT RETREIVAL ==========================');
  GET_PROD_STRING_VIASQLDEV(1001);
  GET_PROD_STRING_VIASQLDEV(1002);
  GET_PROD_STRING_VIASQLDEV(2222);
  dbms_output.put_line('===========TEST SIMPLE SALES ==========================');
  ADD_SIMPLE_SALE_VIASQLDEV(1,1001,15);
  ADD_SIMPLE_SALE_VIASQLDEV(2,1002,37);
  ADD_SIMPLE_SALE_VIASQLDEV(3,1002,15);
  ADD_SIMPLE_SALE_VIASQLDEV(4,1001,100);
  SUM_CUST_SALES_VIASQLDEV;
  SUM_PROD_SALES_VIASQLDEV;
  dbms_output.put_line('===========MORE TESTING OF SIMPLE SALES ==========================');
  ADD_SIMPLE_SALE_VIASQLDEV(99,1002,60);
  ADD_SIMPLE_SALE_VIASQLDEV(2,5555,60);
  ADD_SIMPLE_SALE_VIASQLDEV(1,1002,6666);
  SUM_CUST_SALES_VIASQLDEV;
  SUM_PROD_SALES_VIASQLDEV;
  dbms_output.put_line('==========LIST ALL CUSTOMERS AND PRODUCTS==========================');
  GET_CUST_STRING_VIASQLDEV(1);
  GET_CUST_STRING_VIASQLDEV(2);
  GET_CUST_STRING_VIASQLDEV(3);
  GET_CUST_STRING_VIASQLDEV(4);
  GET_PROD_STRING_VIASQLDEV(1001);
  GET_PROD_STRING_VIASQLDEV(1002);
  GET_PROD_STRING_VIASQLDEV(1003);
END;
/

BEGIN
  dbms_output.put_line('Student ID: 700513X');
  dbms_output.put_line('==========PART 2 TEST CURSOR==========================');
  GET_ALLCUST_VIASQLDEV;
  GET_ALLPROD_VIASQLDEV;
END;
/

BEGIN
  dbms_output.put_line('Student ID: 700513X');
  dbms_output.put_line('==========PART 3 TEST LOCATIONS==========================');
  ADD_LOCATION_VIASQLDEV ('AF201',1,2);
  ADD_LOCATION_VIASQLDEV ('AF202',-3,4);
  ADD_LOCATION_VIASQLDEV ('AF203',5,1);
  ADD_LOCATION_VIASQLDEV ('AF204',6,7000);
  ADD_LOCATION_VIASQLDEV ('AF20111',8,9);
END;
/

BEGIN
  dbms_output.put_line('Student ID: 700513X');
  dbms_output.put_line('==========PART 4==========================');
  ADD_CUSTOMER_VIASQLDEV(10,'Mieko Hayashi');
  ADD_CUSTOMER_VIASQLDEV(11,'John Kalia');
  ADD_CUSTOMER_VIASQLDEV(12,'Alex Kim');
  ADD_PRODUCT_VIASQLDEV(2001,'Chair', 10);
  ADD_PRODUCT_VIASQLDEV(2002,'Table', 45);
  ADD_PRODUCT_VIASQLDEV(2003,'Lamp', 22);
  ADD_COMPLEX_SALE_VIASQLDEV (10,2001,6,'20140301');
  ADD_COMPLEX_SALE_VIASQLDEV (10,2002,1,'20140320');
  ADD_COMPLEX_SALE_VIASQLDEV (11,2001,1,'20140301');
  ADD_COMPLEX_SALE_VIASQLDEV (11,2003,2,'20140215');
  ADD_COMPLEX_SALE_VIASQLDEV (12,2001,10,'20140131');
  COUNT_PRODUCT_SALES_VIASQLDEV(100);
  GET_ALLSALES_VIASQLDEV;
  ADD_COMPLEX_SALE_VIASQLDEV (99,2001,10,'20140131');
  ADD_COMPLEX_SALE_VIASQLDEV (12,9999,10,'20140131');
  ADD_COMPLEX_SALE_VIASQLDEV (12,2001,9999,'20140131');
  ADD_COMPLEX_SALE_VIASQLDEV (12,2001,10,'99999999');
  UPD_CUST_STATUS_VIASQLDEV(12,'SUSPEND');
  ADD_COMPLEX_SALE_VIASQLDEV (12,2002,10,'20140131');
END;
/

BEGIN
  dbms_output.put_line('Student ID: 700513X');
  dbms_output.put_line('==========PART 5==========================');
  ADD_CUSTOMER_VIASQLDEV(10,'Mieko Hayashi');
  ADD_CUSTOMER_VIASQLDEV(11,'John Kalia');
  ADD_CUSTOMER_VIASQLDEV(12,'Alex Kim');
  ADD_PRODUCT_VIASQLDEV(2001,'Chair', 10);
  ADD_PRODUCT_VIASQLDEV(2002,'Table', 45);
  ADD_PRODUCT_VIASQLDEV(2003,'Lamp', 22);
  ADD_COMPLEX_SALE_VIASQLDEV (10,2001,6,'20140301');
  ADD_COMPLEX_SALE_VIASQLDEV (10,2002,1,'20140320');
  ADD_COMPLEX_SALE_VIASQLDEV (11,2001,1,'20140301');
  ADD_COMPLEX_SALE_VIASQLDEV (11,2003,2,'20140215');
  ADD_COMPLEX_SALE_VIASQLDEV (12,2001,10,'20140131');
  COUNT_PRODUCT_SALES_VIASQLDEV(100);
  GET_ALLSALES_VIASQLDEV;
  DELETE_SALE_VIASQLDEV;
  GET_ALLSALES_VIASQLDEV;
  DELETE_SALE_VIASQLDEV;
  GET_ALLSALES_VIASQLDEV;
  DELETE_ALL_SALES_VIASQLDEV;
  GET_ALLSALES_VIASQLDEV;
END;
/

BEGIN
  dbms_output.put_line('Student ID: 700513X');
  dbms_output.put_line('==========PART 6==========================');
  ADD_CUSTOMER_VIASQLDEV(17,'Stephen Ward');
  ADD_CUSTOMER_VIASQLDEV(18,'Lisa Church');
  ADD_CUSTOMER_VIASQLDEV(19,'Joel Pairman');
  ADD_PRODUCT_VIASQLDEV(2005,'Desk', 195);
  ADD_PRODUCT_VIASQLDEV(2006,'Footrest', 20);
  ADD_PRODUCT_VIASQLDEV(2007,'Bookcase', 85);
  ADD_COMPLEX_SALE_VIASQLDEV (17,2005,1,'20140302');
  ADD_COMPLEX_SALE_VIASQLDEV (17,2006,1,'20140303');
  ADD_COMPLEX_SALE_VIASQLDEV (19,2005,1,'20140304');
  DELETE_CUSTOMER_VIASQLDEV (17);
  DELETE_CUSTOMER_VIASQLDEV(18);
  DELETE_CUSTOMER_VIASQLDEV(19);
  DELETE_PROD_VIASQLDEV (2005);
  DELETE_PROD_VIASQLDEV(2006);
  DELETE_PROD_VIASQLDEV(2007);
END;